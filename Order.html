<!DOCTYPE html>
<html class="no-js">
  <head>
    <meta charset="utf-8">
    <title>Ambica Darbar Batti</title>
    <meta name="description" content="Ambica Darbar Batti">
    <meta name="Ambica Darbar Batti" content="True">
    <meta name="MobileOptimized" content="320">
   <meta name="viewport" content="width=device-width,height=device-height,initial-scale=1.0"/>
    <meta name="msapplication-TileColor" content="#222222">

    <!-- Add to homescreen for Chrome on Android -->
    <meta name="mobile-web-app-capable" content="yes">

    <!-- SEO: If mobile URL is different from desktop URL, add a canonical link to the desktop page -->
    <!--
    <link rel="canonical" href="http://www.example.com/" >
    -->

    <!-- For iOS web apps. Delete if not needed. https://github.com/h5bp/mobile-boilerplate/issues/94 -->
    <!--
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="">
    -->

    <!-- Fonts -->
    <link href='https://fonts.googleapis.com/css?family=Montserrat:400,700' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Roboto:400,700,100' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Varela+Round' rel='stylesheet' type='text/css'>
    <!-- Icons -->


    <!-- Stylesheets -->
    <link rel="stylesheet" href="css/animate.css">
    <link rel="stylesheet" href="css/materialize.min.css">
    <link rel="stylesheet" href="css/swipebox.min.css">
    <link rel="stylesheet" href="css/swiper.min.css">
    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" type="text/css" href="bootstrap/css/bootstrap.css">
    <link rel="stylesheet" type="text/css" href="bootstrap/css/css/font-awesome.css">
    <link rel="stylesheet" type="text/css" href="css/demo.css" />
	  <link rel="stylesheet" type="text/css" href="css/component1.css" />
    <script src="js/vendor/modernizr-2.7.1.min.js"></script>
    <script src="js/polyfills.js"></script>
    <link rel="stylesheet" type="text/css" href="css/datatable.css">
    <style>
      .rnd{
    font-size: 1.6em;
    width: 2em;
    text-align: center;
    line-height: 2em;
    background: #905FAA;
    color: #fff;
    border-radius: 1em; /* or 50% width & line-height */
    position: absolute;
    bottom:15px;
    right:15px;
    z-index: 9999;
  }

    </style>
  </head>
  
  <body>
<!-- <div class="rnd" id="add">
  <i class="fa fa-plus"></i>
</div>  -->      
    <!-- Main Container -->
    <div id="main" class="main">

      <!-- Toolbar -->
      <div id="toolbar" class="primary-color z-depth-1">
        <div class="open-left" id="open-left" data-activates="slide-out-left">
          <i class="fa fa-bars" style="font-size:20px;margin-top:22px;"></i>
        </div>
        <h1 class="title">Ambica CRM</h1>
        <div class="open-right" id="open-right" data-activates="slide-out">
          &nbsp;
        </div>
      </div>
      <!-- End of Toolbar -->

      <!-- Page Contents -->
      <div class="page">
        <!-- Your contents goes here! -->

<div class="container-fluid" style="padding:0px;">
<div style="background: #fff;color:#000;padding:15px;margin-bottom: 5px;">
<table id="loadOrderData" style="margin-bottom: 0px;"></table>
</div>
<form id="corder">
<input type="hidden" name="oid" id="oid"/>
<div class="table table-responsive">
<table class="table table-bordered" id="my-example" style="width:1024px">
    <thead>
        <tr style="background-color: #9C2B76">
            <th width="7%">Item Code</th>
            <th width="30%">Item Name</th>
            <th width="10%">Qty</th>
            <th width="10%">Price</th>
            <th width="10%">Billed Qty</th>
            <th width="10%">Rate</th>
            <th width="10%">Del</th>
        </tr>
    </thead>
    <tbody style="background-color: #fff;color:#000"></tbody>
</table>
<br>
</div>
<center><img src="img/preloader.gif" style="width:30px;height:30px;display:none" id="loader"></center>
<button type="button" class="mybtn2" id="add">ADD PRODUCTS</button>
<input type="submit" name="submit" class="mybtn pull-right" value="GENERATE INVOICE" id="gb"/>
</form>




</div>

<div class="component">
				<!-- Start Nav Structure -->
				<button class="cn-button" id="cn-button">+</button>
				<div class="cn-wrapper" id="cn-wrapper">
				    <ul>
				      <li><a href="Screen_DB.html" class="waves-effect"><i class="fa fa-home"></i></a></li>
                <li><a href="#" class="waves-effect"><i class="fa fa-edit"></i></a></li>
                <li><a href="View_Orders_DB.html" class="waves-effect"><i class="fa fa-eye"></i></a></li>
				      <li><a href="#"><i class="fa fa-user-circle-o"></i></a></li>
				      <li><a href="#"><i class="fa fa-bar-chart-o"></i></a></li>
				     </ul>
				</div>
				<div id="cn-overlay" class="cn-overlay"></div>
				<!-- End Nav Structure -->
			</div>

    
</div>
      </div> 
      <!-- End of Page Contents -->

      <!-- Sidebars -->
      <!-- Left Sidebar -->
      <ul id="slide-out-left" class="side-nav collapsible">
        <li class="sidenav-avatar" style="background-color: #BCBADE">
          <div class="opacity-overlay-gradient"></div>
          <div class="bottom">
            <img src="img/user.png" alt="" class="avatar">
            <!-- Dropdown Trigger -->
            <span class="dropdown-button waves-effect waves-light" data-activates="dropdown1">
            <span id="uname"></span></span>
          </div>
        </li>
        <div id="dbleft"></div>
      </ul>

<div id="itemModal" class="modal fade" role="dialog" style="width:100%;background-color: transparent;">
  <div class="modal-dialog">

    <!-- Modal content-->
    <div class="modal-content" style="padding:0px;">
      <div class="modal-header" style="background-color: #905FAA;color:#fff">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">ADD PRODUCT</h4>
      </div>
      <div class="modal-body">
<select name="group" id="group" class="form-control" onchange="showProducts(this.value)">
    <option value="">Select Group</option>
</select>
<br>
<div id="sdata" style="margin-bottom:10px;">
<select name="product" id="product" class="form-control" onchange="doOperationDB(this.value)" tabindex="1">
  <option value="">CHOOSE ITEM</option>
</select>
</div>
      <input type="text" name="qty" id="qty" class="form-control" placeholder="Quantity" onblur="updatePrice(this.value);"/>
      <input type="text" name="itemname" id="itemname" class="form-control" placeholder="Item Name"/>
      <!-- <input type="text" name="qtycases" id="qtycases" class="form-control" placeholder="Quantity in Cases" tabindex="2"/>
      <input type="hidden" name="qtypacks" id="qtypacks" class="form-control" placeholder="Quantity in Packs"/> -->
      <input type="hidden" name="price" id="price" class="form-control" placeholder="Price"/>
      <!-- <input type="hidden" name="weight" id="weight" class="form-control" placeholder="Weight in Kgs"/> -->
      <input type="hidden" name="billedqty" id="billedqty" class="form-control" placeholder="Billed Quantity"/>
      <input type="hidden" name="taxrate" id="taxrate" class="form-control" placeholder="Tax Rate"/>
      <input type="hidden" name="rate" id="rate" class="form-control" placeholder="Rate"/>
      <input type="text" name="perbox" id="perbox" class="form-control" placeholder="Per Box"/>
      <input type="hidden" name="itemcode" id="itemcode" class="form-control" placeholder="Item Code"/>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-success" data-dismiss="modal" onclick="addData2Row();" style="margin-left:10px;">Add</button>
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <img src="img/preloader.gif" style="width:20px;height:20px;display:none" id="ploader">
      </div>
    </div>

  </div>
</div>

    </div>
    <!-- End of Main Container -->
    
    <!-- Scripts -->
    <script src="js/vendor/jquery-2.1.0.min.js"></script>
    <script src="bootstrap/js/bootstrap.js"></script>
    <script src="js/helper.js"></script>
    <script src="js/vendor/HeadsUp.js"></script>
    <script src="js/vendor/chart.min.js"></script>
    <script src="js/vendor/jquery.mixitup.min.js"></script>
    <script src="js/vendor/jquery.swipebox.min.js"></script>
    <script src="js/vendor/masonry.min.js"></script>
    <script src="js/vendor/swiper.min.js"></script>
    <script src="js/vendor/materialize.min.js"></script>
    <script src="js/main.js"></script>
     <script src="js/datatables.js"></script>
     <script src="js/custome.js"></script>
    <script>
        $(function(){
if(localStorage.getItem("Role") != null){
  /*if(localStorage.getItem('Role') == 'SR'){
    location.href="Screen_SR.html";
  }*/
}else{
    location.href="index.html";
}

$("#oid").val(localStorage.getItem("Order"));
$("#add").on('click', function(e){
           e.preventDefault();
           $("#itemModal").modal("show");
        });

$.ajax({
  url:server+"updateOrder.php?order="+localStorage.getItem("Order"),
  type:"GET",
  success: function(str){
    console.log(str.Status);
  }
});
$("#loadOrderData").load(server+"getOrderByOrder.php?order="+localStorage.getItem("Order"));
$.ajax({
          url:server+"getStatusByOrder.php",
          data:{"Order_No":localStorage.getItem("Order")},
          type:"POST",
          beforeSend: function(){
           $("#ploader").show();
          },
          success:function(str){
            if(str.Status == 'Invoiced'){
$("#add").hide();
$("#gb").hide();
$.ajax({
          url:server+"getInvoiceData.php",
          data:{"Invoice_No":str.Invno},
          type:"POST",
          beforeSend: function(){
           $("#ploader").show();
          },
          success:function(data){
            $("#ploader").hide();
            //console.log(data);
                  var toAppend = '';
                     $.each(data,function(i,o){
                        toAppend += '<tr><td>'+o.Item_Code+'</td><td>'+o.Item_Name+'</td><td>'+o.Qty_In_Cases+'</td><td>'+o.Qty_In_Packs+'</td><td>'+o.Amount+'</td><td>'+o.Weight_In_Kgs+'</td><td>'+o.Billd_Qty+'</td><td>'+o.CGST_Amnt+'</td><td>'+o.SGST_Amnt+'</td><td>'+o.IGST_Amnt+'</td><td>'+o.Price+'</td><td></td></tr>';
                    });

                   $('#my-example').append(toAppend);

          }
          });

            }else{

$.ajax({
          url:server+"getOrderById.php",
          data:{"Order_No":localStorage.getItem("Order")},
          type:"POST",
          beforeSend: function(){
           $("#ploader").show();
          },
          success:function(data){
            $("#ploader").hide();
            //console.log(data);
                  var toAppend = '';
                     $.each(data,function(i,o){
                        toAppend += '<tr><td><input type="text" name="itemcode[]" value="'+o.Item_Code+'" style="color:#000" readonly="readonly"/></td><td><input type="text" name="itemname[]" value="'+o.Item_Name+'" style="color:#000" readonly="readonly"/></td><td><input type="text" name="qty[]" id="qty'+i+'" value="'+o.Billd_Qty+'" onblur="updateRate(this.value,'+i+')"/><input type="hidden" name="cgst[]" id="cgst'+i+'" value="'+o.CGST_Per+'"/><input type="hidden" name="sgst[]" id="sgst'+i+'" value="'+o.SGST_Per+'"/><input type="hidden" name="igst[]" id="igst'+i+'" value="'+o.IGST_Per+'"/></td><td><input type="text" name="price[]" id="price'+i+'" value="'+o.Price+'" onblur="updateRate2(this.value,'+i+')" style="color:#000"/></td><td><input type="text" name="billedqty[]" value="'+o.Billd_Qty+'"  style="color:#000" readonly="readonly"/></td><td><input type="text" name="rate[]" id="rate'+i+'" value="'+o.Amount+'" style="color:#000" readonly="readonly"/></td><td><a href="javascript:void(0);" class="remCF">Remove</a></td></tr>';
                       
                     
                    });

                   $('#my-example').append(toAppend);

          }
          });

            }
          }
        });

    

$("#my-example").on('click','.remCF',function(){
        $(this).parent().parent().remove();
    });
$.ajax({
          url:server+"GetDistributors.php",
          data:{"SalesmenCode":localStorage.getItem("Emp_Code")},
          type:"POST",
          success:function(data){
            console.log(data);
                  var toAppend = '';
                     $.each(data,function(i,o){
                     toAppend += '<option value="'+o.Customer_Id+'">'+o.Customer_Name+'</option>';
                    });

                   $('#dis').append(toAppend);

          }
          });


          $.ajax({
          url:server+"GetGroups.php",
          success:function(data){
                  var toAppend = '';
                     $.each(data,function(i,o){
                     toAppend += '<option value="'+o.Groupid+'">'+o.Groupname+'</option>';
                    });

                   $('#group').append(toAppend);

          }
          });

          $("#corder").on('submit', function(e){
           e.preventDefault();
           var fdata= $("#corder").serialize();
           $.ajax({
              url:server+"insertInvoice.php",
              data:fdata,
              type:"POST",
              beforeSend:function(){
                $("#loader").show();
              },
              success: function(str){
                $("#loader").hide();
                console.log(str);
                if(str.Status == 'Success'){
                location.href='View_Orders_DB.html';
                }else{
                  alert("Sorry, error happens");
                }
              },
              error: function(jqXHR, status, error){
            $("#loader").hide();
            alert(jqHXR+" -- "+status+" -- "+error);
       }
           });
        });
var button = document.getElementById('cn-button'),
    wrapper = document.getElementById('cn-wrapper'),
    overlay = document.getElementById('cn-overlay');

  //open and close menu when the button is clicked
  var open = false;
  button.addEventListener('click', handler, false);
  button.addEventListener('focus', handler, false);
  wrapper.addEventListener('click', cnhandle, false);

  function cnhandle(e){
    e.stopPropagation();
  }

  function handler(e){
    if (!e) var e = window.event;
    e.stopPropagation();//so that it doesn't trigger click event on document

      if(!open){
        openNav();
      }
    else{
        closeNav();
      }
  }
  function openNav(){
    open = true;
      button.innerHTML = "-";
      classie.add(overlay, 'on-overlay');
      classie.add(wrapper, 'opened-nav');
  }
  function closeNav(){
    open = false;
    button.innerHTML = "+";
    classie.remove(overlay, 'on-overlay');
    classie.remove(wrapper, 'opened-nav');
  }
  document.addEventListener('click', closeNav);
   
        });

function updateRate(no,i){
      var price = $("#price"+i).val();
      var trate;
      var cgst = $("#cgst"+i).val();
      var sgst = $("#sgst"+i).val();
      var igst = $("#igst"+i).val();
      if(cgst != 0){
        trate = parseFloat(cgst)+parseFloat(sgst);
      }else{
        trate = igst;
      }
      var total = price*no;
      var per = ((price*no)*trate)/100;
      var fp = total+parseInt(per);
      console.log(trate);
      $("#rate"+i).val(parseInt(fp));
      $("#billedqty"+i).val(no);
    }

  function updateRate2(price,i){
      var no = $("#qty"+i).val();
      var trate;
      var cgst = $("#cgst"+i).val();
      var sgst = $("#sgst"+i).val();
      var igst = $("#igst"+i).val();
      if(cgst != 0){
        trate = parseFloat(cgst)+parseFloat(sgst);
      }else{
        trate = igst;
      }
      console.log(no);
      var total = price*no;
      var per = ((price*no)*trate)/100;
      var fp = total+parseInt(per);
      // console.log(fp);
      $("#rate"+i).val(fp);
      $("#billedqty"+i).val(no);
    }

  function chageStatus(){

   $.ajax({
          url:"http://apkser.laksanasoft.com/Login/changestatus",
          data:{"Order_No":localStorage.getItem("Order")},
          type:"GET",
          success:function(data){
            if(data.Success == 'True'){
              alert('Invoice Generated');
            }
          }
          }); 
  }


   function updateSale(did){
      console.log(did);
    $.ajax({
          url:server+"getSaletype.php",
          data:{"Customer_Id":did},
          type:"POST",
          success:function(data){
            console.log(data);
            if(data.length>0){
              $("#saletype").val(data[0].Prefix);  
            }else{
              $("#saletype").val('');
            }
            
            }
          });

    }


    function addItems(icode,iname,nunits,npacks,weight,cunits,price){
      $("#sdata").hide();
      $("#itemname").val(iname);
      $("#qtyunits").val(nunits);
      $("#qtypacks").val(npacks);
      $("#price").val(nunits);
      $("#weight").val(weight);
      $("#actualqtyunits").val(nunits);
      $("#perbox").val(cunits);
      $("#itemcode").val(icode);
      //console.log(icode+","+iname+","+nunits+","+npacks+","+weight+","+cunits+","+price);
    }
    function updatePrice(no){ 
      console.log(no);
      var price = $("#price").val();
      var trate = $("#taxrate").val();
      var total = price*no;
      var per = ((price*no)*trate)/100;
      var fp = total+per;
      //$("#rate").val(fp);
      $("#rate").val(total);
      $("#billedqty").val(no);
      $("#qtycases").val(no);
    }
    var i = 1;
    function addData2Row(){
      
var markup = '<tr><td width="10%"><input type="number" name="itemcode[]" class="form-control" value="'+$("#itemcode").val()+'"/></td><td width="20%"><input type="text" name="itemname[]" class="form-control" value="'+$("#itemname").val()+'"/></td><td><input type="text" name="qty[]" id="qty'+i+'" class="form-control" value="'+$("#qty").val()+'"/></td><td width="10%"><input type="text" name="price[]" class="form-control" value="'+$("#price").val()+'" onblur="updatePrice1(this.value,'+i+');"/></td><td width="5%"><input type="text" name="billedqty[]" class="form-control" value="'+$("#qty").val()+'"/><input type="hidden" name="taxrate[]" id="taxrate'+i+'" class="form-control" value="'+$("#taxrate").val()+'"/></td><td width="5%"><input type="text" name="rate[]" id="rate'+i+'n" class="form-control" value="'+$("#rate").val()+'"/></td><td><a href="javascript:void(0);" class="remCF">Remove</a></td></tr>';
$("table tbody").append(markup);
$("#itemname").val('');
$("#qtyunits").val('');
$("#qtypacks").val('');
$("#price").val('');
$("#weight").val('');
$("#actualqty").val('');
$("#perbox").val('');
$("#itemcode").val('');
$("#qty").val('');
$("#qtycases").val('');
$("#billedqty").val('');
$("#rate").val('');
    i++;
    }

function updatePrice1(price,i){
      var no = $("#qty"+i).val();
      var trate = $("#taxrate"+i).val();
      var total = price*no;
      var per = ((price*no)*trate)/100;
      var fp = total+per;
      //$("#rate"+i+"n").val(fp);
      $("#rate"+i+"n").val(total);
      console.log(price+","+no+","+trate+","+per+","+fp);
    }
  </script>
  </body>
</html>
