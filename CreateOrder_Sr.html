<!DOCTYPE html>
<html class="no-js">
  <head>
    <meta charset="utf-8">
    <title>Ambica Darbar Batti</title>
    <meta name="description" content="Ambica Darbar Batti">
    <meta name="Ambica Darbar Batti" content="True">
    <meta name="MobileOptimized" content="320">
   <meta name="viewport" content="width=device-width,height=device-height,initial-scale=1.0"/>
    <meta name="msapplication-TileColor" content="#222222">

    <!-- Add to homescreen for Chrome on Android -->
    <meta name="mobile-web-app-capable" content="yes">

    <!-- SEO: If mobile URL is different from desktop URL, add a canonical link to the desktop page -->
    <!--
    <link rel="canonical" href="http://www.example.com/" >
    -->

    <!-- For iOS web apps. Delete if not needed. https://github.com/h5bp/mobile-boilerplate/issues/94 -->
    <!--
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="">
    -->

    <!-- Fonts -->
    <link href='https://fonts.googleapis.com/css?family=Montserrat:400,700' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Roboto:400,700,100' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Varela+Round' rel='stylesheet' type='text/css'>
    <!-- Icons -->

    <!-- Stylesheets -->
   <link rel="stylesheet" href="css/animate.css">
    <link rel="stylesheet" href="css/materialize.min.css">
    <link rel="stylesheet" href="css/swipebox.min.css">
    <link rel="stylesheet" href="css/swiper.min.css">
    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" type="text/css" href="bootstrap/css/bootstrap.css">
    <link rel="stylesheet" type="text/css" href="bootstrap/css/css/font-awesome.css">
    <link rel="stylesheet" type="text/css" href="css/demo.css" />
    <link rel="stylesheet" type="text/css" href="css/component1.css" />
    <script src="js/vendor/modernizr-2.7.1.min.js"></script>
    
  <style>
  .rnd{
    font-size: 1.6em;
    width: 2em;
    text-align: center;
    line-height: 2em;
    background: #905FAA;
    color: #fff;
    border-radius: 1em; /* or 50% width & line-height */
    position: absolute;
    bottom:15px;
    right:15px;
    z-index: 9999;
  }

  </style>  
  </head>
  
  <body style="background: #fff">
<!-- <div class="rnd" id="add">
  <i class="fa fa-plus"></i>
</div> -->


    <!-- Main Container -->
    <div id="main" class="main">

<div id="fgps" style="z-index: 9999;top:30%;position: absolute;width:100%;margin:0 auto;display:none">
  <div class="modal-dialog">
    <!-- Modal content-->
    <div class="modal-content" style="padding:0px;">
      <div class="modal-header" style="background-color: #905FAA;color:#fff">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">GPS MESSAGE</h4>
      </div>
      <div class="modal-body">
    <h3 style="color:#000;text-align: center;">Your GPS is OFF</h3>
    <BR>
    <center><button class="mybtn2"onclick="javascript:window.location.reload(true);">REFRESH</button></center>
      </div>
    </div>

  </div>
</div>

      <!-- Toolbar -->
      <div id="toolbar" class="primary-color z-depth-1">
        <div class="open-left" id="open-left" data-activates="slide-out-left">
          <i class="fa fa-bars" style="font-size:20px;margin-top:22px;"></i>
        </div>
        <h1 class="title">Ambica CRM</h1>
        <div class="open-right" id="open-right" data-activates="slide-out">
          &nbsp;
        </div>
      </div>
      <!-- End of Toolbar -->

      <!-- Page Contents -->
      <div class="page">
        <!-- Your contents goes here! -->
                                                  <br>
<div class="container" style="padding:0px;">

<form id="corder">
<div id="first">

<select name="dis" id="dis" class="form-control" onchange="showCustomers(this.value),updateSale(this.value);" required>
    <option value="">Select Distributor</option>
</select>
<br>
<select name="customer" id="customer" class="form-control">
    <option value="">Select Customer</option>
</select>
<br>
<input type="hidden" name="location" id="location" value=""/>
<input type="text" name="customer1" id="customer1" class="form-control" placeholder="ADD CUSTOMER"/><br>
<input type="text" name="saletype" id="saletype" class="form-control" placeholder="SALE ORDER TYPE" readonly="readonly"/><br>
<span style="color:#000">DELIVERY DATE</span>
<input type="date" name="deldate" class="form-control" required="required"/><br>
</div>

<div id="second">
<div class="table-responsive" style="z-index:999">
  <table class="table table-bordered" style="width:1500px;color:#000;">
<thead>
    <tr class="info">
        <th>Item Code</th><th>Item Name</th><th>Quantity</th><th>Price</th><th>Billed Quantity</th><th>Tax Rate</th><th>Amount</th><th>Per</th><th>Remove</th>
    </tr>
</thead>
<tbody></tbody>
  </table>
</div>
</div>
<input type="hidden" name="company" value="5"/>
<input type="hidden" name="cby" id="cby" value=""/>
<button type="button" class="mybtn2" id="add">ADD PRODUCTS</button>
<input type="submit" name="submit" class="mybtn pull-right" value="CREATE ORDER"/>
<center><img src="img/preloader.gif" style="width:40px;height:40px;display:none" id="loader"/></center>
</form>
</div>
      </div>

      <!-- End of Page Contents -->

      <!-- Sidebars -->
      <!-- Left Sidebar -->
      <ul id="slide-out-left" class="side-nav collapsible">
        
        <li class="sidenav-avatar" style="background-color: #BCBADE">
          <div class="opacity-overlay-gradient"></div>
          <div class="bottom">
            <img src="img/user.png" alt="" class="avatar">
            <!-- Dropdown Trigger -->
            <span class="dropdown-button waves-effect waves-light" data-activates="dropdown1">
            <span id="uname"></span></span>
          </div>
        </li>
        <div id="srleft"></div>
      </ul>

    </div>


<div id="itemModal" style="width:100%;background-color: transparent;position: absolute;top:10%;z-index: 9999;display: none">
  <div class="modal-dialog">

    <!-- Modal content-->
    <div class="modal-content" style="padding:0px;">
      <div class="modal-header" style="background-color: #905FAA;color:#fff">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">ADD PRODUCT</h4>
      </div>
      <div class="modal-body">
<select name="group" id="group" class="form-control" onchange="showProducts(this.value)">
    <option value="">Select Group</option>
</select>
<br>
<div id="sdata" style="margin-bottom:10px;">
<select name="product" id="product" class="form-control" onchange="doOperation(this.value)" tabindex="1" style="font-size: 8px;">
  <option value="">CHOOSE ITEM</option>
</select>
</div>
      <input type="text" name="qty" id="qty" class="form-control" placeholder="Quantity" onblur="updatePrice(this.value);"/>
      <input type="hidden" name="itemname" id="itemname" class="form-control" placeholder="Item Name"/>
      <input type="text" name="price" id="price" class="form-control" placeholder="Price" readonly="readonly" />
      <input type="hidden" name="billedqty" id="billedqty" class="form-control" placeholder="Billed Quantity"/>
      <input type="hidden" name="taxrate" id="taxrate" class="form-control" placeholder="GST Rate"/>
      <input type="hidden" name="rate" id="rate" class="form-control" placeholder="Amount"/>
      <input type="text" name="perbox" id="perbox" class="form-control" placeholder="UOM" readonly="readonly"/>
      <input type="hidden" name="itemcode" id="itemcode" class="form-control" placeholder="Item Code"/>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-success" data-dismiss="modal" onclick="addData2Row();" style="margin-left:10px;">Add</button>
        <button type="button" class="btn btn-default" onclick="closeItem();">Close</button>
        <img src="img/preloader.gif" style="width:20px;height:20px;display:none" id="ploader">
      </div>
    </div>
<script>
  function closeItem(){
  $("#itemModal").hide();
}
</script>
  </div>
</div>

    <!-- End of Main Container -->
    
    <!-- Scripts -->
    <script src="js/vendor/jquery-2.1.0.min.js"></script>
    <script src="bootstrap/js/bootstrap.js"></script>
    <script src="js/helper.js"></script>
    <script src="js/vendor/HeadsUp.js"></script>
    <script src="js/vendor/chart.min.js"></script>
    <script src="js/vendor/jquery.mixitup.min.js"></script>
    <script src="js/vendor/jquery.swipebox.min.js"></script>
    <script src="js/vendor/masonry.min.js"></script>
    <script src="js/vendor/swiper.min.js"></script>
    <script src="js/vendor/materialize.min.js"></script>
    <script src="js/main.js"></script>
    <script src="js/custome.js"></script>
    <script>
        $(function(){
         $("#add").hide();
         $("#add").on('click', function(e){
           e.preventDefault();
           $("#itemModal").show();
        });
        getLocation();
        $("#cby").val(localStorage.getItem("Emp_Code"));
        $("#corder").on('submit', function(e){
           e.preventDefault();
           var fdata= $("#corder").serialize();
           $.ajax({
              url:server+"insertOrderSr.php",
              data:fdata,
              type:"POST",
              beforeSend:function(){
                $("#loader").show();
              },
              success: function(str){
                $("#loader").hide();
                console.log(str);
                if(str.Status == 'Success'){
                location.href='View_Orders_SR.html';
                }else{
                  alert("Sorry, error happens");
                }
              },
              error: function(jqXHR, status, error){
            $("#loader").hide();
            alert(jqXHR+" -- "+status+" -- "+error);
       }
           });
        });
        
        $.ajax({
          url:server+"GetDistributors.php",
          data:{"SalesmenCode":localStorage.getItem("Emp_Code")},
          type:"POST",
          success:function(data){
            console.log(data);
                  var toAppend = '';
                     $.each(data,function(i,o){
                     toAppend += '<option value="'+o.Customer_Id+'">'+o.Customer_Name+'</option>';
                    });

                   $('#dis').append(toAppend);

          }
          });


          $.ajax({
          url:server+"GetGroups.php",
          success:function(data){
                  var toAppend = '';
                     $.each(data,function(i,o){
                     toAppend += '<option value="'+o.Groupid+'">'+o.Groupname+'</option>';
                    });

                   $('#group').append(toAppend);

          }
          });

    $("table tbody").on('click','.remCF',function(){
        $(this).parent().parent().remove();
    });
    });
    function showCustomers(cid){
      $("#add").show();
    $.ajax({
          url:server+"getCustomers.php",
          data:{"Customer_Id":cid},
          type:"POST",
          success:function(data){
            console.log(data);
            $("#customer").empty();
                  var toAppend = '';
                     $.each(data,function(i,o){
                     toAppend += '<option value="'+o.Customer_Id+'">'+o.Customer_Name+'</option>';
                    });

                   $('#customer').append(toAppend);
          }
          });

    }

    function updateSale(did){
      console.log(did);
    $.ajax({
          url:server+"getSaletype.php",
          data:{"Customer_Id":did},
          type:"POST",
          success:function(data){
            console.log(data);
            if(data.length>0){
              $("#saletype").val(data[0].Prefix);  
            }else{
              $("#saletype").val('');
            }
            
            }
          });

    }


    function addItems(icode,iname,nunits,npacks,weight,cunits,price){
      $("#sdata").hide();
      $("#itemname").val(iname);
      $("#qtyunits").val(nunits);
      $("#qtypacks").val(npacks);
      $("#price").val(nunits);
      $("#weight").val(weight);
      $("#actualqtyunits").val(nunits);
      $("#perbox").val(cunits);
      $("#itemcode").val(icode);
      //console.log(icode+","+iname+","+nunits+","+npacks+","+weight+","+cunits+","+price);
    }
    function updatePrice(no){ 
      console.log(no);
      var price = $("#price").val();
      var trate = $("#taxrate").val();
      var total = price*no;
      var per = ((price*no)*trate)/100;
      var fp = total+per;
      $("#rate").val(fp);
      $("#billedqty").val(no);
      $("#qtycases").val(no);
    }
    var i = 1;
    function addData2Row(){
if($("#qty").val()!=''){
var markup = '<tr><td width="7%"><input type="number" name="itemcode[]" class="form-control" value="'+$("#itemcode").val()+'" readonly="readonly"/></td><td width="23%"><input type="text" name="itemname[]" class="form-control" value="'+$("#itemname").val()+'" readonly="readonly"/></td><td width="6%"><input type="number" name="qty[]" id="qty'+i+'" class="form-control" value="'+$("#qty").val()+'"/></td><td width="8%"><input type="text" name="price[]" class="form-control" value="'+$("#price").val()+'" onblur="updatePrice1(this.value,'+i+');"/></td><td width="5%"><input type="text" name="billedqty[]" class="form-control" value="'+$("#qty").val()+'" readonly="readonly"/></td><td width="5%"><input type="text" name="taxrate[]" id="taxrate'+i+'" class="form-control" value="'+$("#taxrate").val()+'" readonly="readonly"/></td><td width="5%"><input type="text" name="rate[]" id="rate'+i+'" class="form-control" value="'+$("#rate").val()+'" readonly="readonly"/></td><td width="10%"><input type="text" name="perbox[]" class="form-control" value="'+$("#perbox").val()+'" readonly="readonly"/></td><td width="10%"><a href="javascript:void(0);" class="remCF">Remove</a></td></tr>';
$("table tbody").append(markup);

$("#itemname").val('');
$("#qtyunits").val('');
$("#qtypacks").val('');
$("#price").val('');
$("#weight").val('');
$("#actualqty").val('');
$("#perbox").val('');
$("#itemcode").val('');
$("#qty").val('');
$("#qtycases").val('');
$("#billedqty").val('');
$("#rate").val('');
    i++;
$("#itemModal").hide(); 
  }else{
    alert("Add Quantity");
  }

    }

function updatePrice1(price,i){
      var no = $("#qty"+i).val();
      var trate = $("#taxrate"+i).val();
      var total = price*no;
      var per = ((price*no)*trate)/100;
      var fp = total+per;
      $("#rate"+i).val(fp);
      //console.log(price+","+no+","+trate+","+per+","+fp);
    }
    </script>

    <script>
function getLocation() {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(showPosition);
    } else {
        x.innerHTML = "Geolocation is not supported by this browser.";
    }
}

function showPosition(position) {
  var lat= position.coords.latitude;
  var lng = position.coords.longitude;
$.ajax({
   url:"http://maps.googleapis.com/maps/api/geocode/json?latlng="+position.coords.latitude+","+position.coords.longitude+"&sensor=true/false",
success: function(str){
console.log(str.results[0]);
if(str.results[0] === undefined){
$("#fgps").show();
}else{
$("#location").val(str.results[0]['formatted_address']);
}

}

});



}
</script>

  </body>
</html>
